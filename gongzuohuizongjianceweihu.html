<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <style>
        .wrap {
            padding: 20px;
        }

        .select {
            height: 40px;
            /* border-bottom: 1px solid #ccc; */
            text-align: center;
        }

        .search {
            width: 200px;
            height: 38px;
            margin: 0 auto;
            display: inline-block;
            padding-top: 1px;

        }

        .layui-input {
            border: 0px;
            padding: 0;
            height: 100%;
            width: 100%;
            text-align: center;
        }

        .btn {
            display: inline-block;

        }

        .layui-table td {
            padding: 0px;
            height: 30px;
            line-height: 0px;
            text-align: center;
        }

        .layui-table td {
            margin: 0px;
        }

        .layui-form-item {
            margin: 0px;
            width: 100%;
            height: 100%;
        }

        .layui-form-item .layui-input-inline {
            width: 100%;
            margin: 0px !important;
            height: 100%;
        }

        .layui-unselect {
            height: 100%;
        }

        .layui-select-title {
            height: 100%;
        }

        .title {
            font-size: 16px;
            text-align: center;
            padding: 10px;
        }

        .qianming {
            width: 652px;
            margin: 0 auto;
        }

        ul.qianming li {
            display: inline-block;
            width: 160px;
            height: 30px;
            line-height: 30px;
        }

        ul.qianming input {
            width: 100px;
            display: inline-block;
            border-bottom: 1px solid #ccc;
        }

        .layui-form-checkbox[lay-skin=primary] {
            margin: 0 auto;
            padding: 0px;
        }

        .layui-form-checkbox {
            margin: 0 !important;
        }
        .gc,#gclist {
            display: none;
        }
    </style>
</head>

<body>
    <table class="layui-table">
        <thead>
            <tr>
                <th style="width:10%;">检测日期</th>
                <th style="width:15%;">检测单号</th>
                <th style="width:15%;">检测地点</th>
                <th style="width:30%;" colspan="2">驾驶区间</th>
                <th style="width:5%;">车辆里程</th>
                <th style="width:15%;">运营路况</th>
                <th style="width:5%;">客户经办</th>
                <th style="width:5%;">服务经办</th>
            </tr>
        </thead>
        <tbody class="jcinfo">
            <tr>
                <td><input type="text" data-name="inspectionDt" id="inspectionDt" class="layui-input dates" readonly></td>
                <td><input type="text" data-name="formId" id="formId" class="layui-input" readonly></td>
                <td><input type="text" data-name="place" id="place" class="layui-input" readonly></td>
                <td class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-input-inline" style="width:45%;">
                            <input type="text" id="drivingRange1" class="layui-input" readonly/>
                            <!-- <input class="layui-input" data-name="drivingRange1" type="text"> -->
                        </div>
                        <div class="layui-input-inline" style="width:10%;line-height: 30px; background-color: #EEEEEE;">--</div>
                        <div class="layui-input-inline" style="width:45%;">

                            <input type="text" id="drivingRange2" class="layui-input" readonly/>
                        </div>
                    </div>
                </td>
                <td class="layui-form">
                    <div class="layui-form-item">
                        <div class="layui-input-inline" style="width:45%;">
                             <input type="text" id="drivingRange3" class="layui-input" readonly/>
                        </div>
                        <div class="layui-input-inline" style="width:10%;line-height: 30px; background-color: #EEEEEE;">--</div>
                        <div class="layui-input-inline" style="width:45%;">
                             <input type="text" id="drivingRange4" class="layui-input" readonly/>       
                        </div>
                    </div>
                </td>
                <td><input type="text" data-name="mileage" id="mileage" class="layui-input" readonly></td>

                <td class="layui-form yylk">
                    <div class="layui-form-item">
                        <div class="layui-input-inline">
              
                            <input type="text" id="roadStatus" class="layui-input" readonly>
                        </div>
                    </div>
                </td>
                <td><input type="text" data-name="customerName" id="customerName" class="layui-input" readonly></td>
                <td><input type="text" data-name="attn" id="attn" class="layui-input" readonly></td>
            </tr>
        </tbody>

    </table>

    <div class="title">
        <span class="carnum"></span> 车辆动态
    </div>
    <table class="layui-table">
        <thead>
            <tr>
                <th colspan="7">轮胎信息</th>
                <th colspan="9" class="layui-form">
                    <div style="display: inline-block;line-height: 38px;">本期轮胎检测信息</div>
                    <div style="width:150px;display: inline-block;line-height: 38px;">
                        <label class="layui-form-label" style="padding:0 10px;margin: 0;line-height: 38px;">胎压调节</label>
                        <div class="layui-input-inline" style="width:30px;">
                            <input type="checkbox" lay-skin="primary" title="" checked="">
                        </div>

                    </div>
                    <div style="width:150px;display: inline-block;line-height: 38px;">
                        <label class="layui-form-label" style="padding:0 10px;margin: 0;line-height: 38px;">异物清理</label>
                        <div class="layui-input-inline" style="width:30px;">
                            <input type="checkbox" lay-skin="primary" title="" checked="">
                        </div>
                    </div>
                </th>
                <th colspan="6">上期轮胎监测信息</th>
            </tr>
            <tr>
                <th style="min-width:30px;">序号</th>
                <th>品牌</th>
                <th>型号</th>
                <th>规格</th>
                <th>胎号</th>
                <th>胎位</th>
                <th>报错</th>
                <th>胎压</th>
                <th>芯/帽</th>
                <th>小修</th>
                <th colspan="4">内外平均纹深度</th>
                <th>轮胎状态</th>
                <th>使用建议</th>
                <th>胎压</th>
                <th colspan="4">内外评论纹深度</th>
                <th>轮胎状态</th>
            </tr>
        </thead>

        <tbody id="list">
        </tbody>
    </table>
    <div class="title" class="gc">
        <span class=" gcarnum"></span> 车辆动态
    </div>
    <table class="layui-table gc">
        <thead>
            <tr>
                <th colspan="9" class="layui-form">
                    <div style="display: inline-block;line-height: 38px;">本期轮胎检测信息</div>
                    <div style="width:150px;display: inline-block;line-height: 38px;">
                        <label class="layui-form-label" style="padding:0 10px;margin: 0;line-height: 38px;">胎压调节</label>
                        <div class="layui-input-inline" style="width:30px;">
                            <input type="checkbox" lay-skin="primary" title="" checked="">
                        </div>
                    </div>
                    <div style="width:150px;display: inline-block;line-height: 38px;">
                        <label class="layui-form-label" style="padding:0 10px;margin: 0;line-height: 38px;">异物清理</label>
                        <div class="layui-input-inline" style="width:30px;">
                            <input type="checkbox" lay-skin="primary" title="" checked="">
                        </div>
                    </div>
                </th>
                <th colspan="6">上期轮胎监测信息</th>
            </tr>
            <tr>
                <th style="min-width:30px;">序号</th>
                <th>品牌</th>
                <th>型号</th>
                <th>规格</th>
                <th>胎号</th>
                <th>胎位</th>
                <th>报错</th>
                <th>胎压</th>
                <th>芯/帽</th>
                <th>小修</th>
                <th colspan="4">内外平均纹深度</th>
                <th>轮胎状态</th>
                <th>使用建议</th>
                <th>胎压</th>
                <th colspan="4">内外评论纹深度</th>
                <th>轮胎状态</th>
            </tr>
        </thead>
        <tbody id="gclist">
        </tbody>
    </table>
    <table class="layui-table" class="jfxf">
        <tbody>
            <tr>
                <td style="width:10%;">费用合计</td>
                <td style="width:10%;"><input type="text" data-name="allFee" id="allFee" class="layui-input" value="" readonly></td>
                <td style="width:10%;">消费积分</td>
                <td style="width:10%;"><input type="text" data-name="integralFee" id="integralFee" class="layui-input" value="" readonly></td>
                <td style="width:10%;">实收金额</td>
                <td style="width:10%;"><input type="text" data-name="actualFee" id="actualFee" class="layui-input" value="" readonly></td>
                <td style="width:10%;">付款方式</td>
                <td style="width:10%;">
                	<input type="text" data-name="integral" class="layui-input" id="paidMethod" value="" readonly>
                </td>
                <td style="width:10%;">本次积分</td>
                <td style="width:10%;"><input type="text" data-name="integral" id="integral" class="layui-input" value="" readonly></td>
            </tr>
        </tbody>
    </table>
    <div class="title">
        <!--<button class="layui-btn  layui-btn-sm layui-btn-normal" >确认</button>-->
    </div>
</body>
<script src="./js/Global.js"></script>
<script>

    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串  
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    let layform = ''
    layui.use('form', function () {
        layform = layui.form
    })
    layui.use('laydate', function () {
        layui.laydate.render({
            elem: '.dates'
        })
    })
    let jcwhlist = []
    let fkfs = []
    let syjy = []
    $.ajax({
        url: `${API}/erpSystemParameters/getparametersByName?name=付款方式`,
        type: 'get',
        success: function (res) {
            let arr = res.data.parametersChildList
            let str = '<option></option>'
            $.each(arr, function (i, k) {
                str += `<option value="${k.name}" >${k.name}</option>`
                fkfs.push({
                    name: k.name
                })
            })
            $('.fkfslist').html(str)
            layform.render()
        }
    })
    $.ajax({
        url: `${API}/erpSystemParameters/getparametersByName?name=使用建议`,
        type: 'get',
        success: function (res) {
            let arr = res.data.parametersChildList
            let str = '<option></option>'
            $.each(arr, function (i, k) {
                str += `<option value="${k.name}" >${k.name}</option>`
                syjy.push({
                    name: k.name
                })
            })
            $('.syjy').html(str)
            layform.render()
        }
    })
    $.ajax({
        url: `${API}/erpSystemParameters/getparametersByName?name=运营路况`,
        type: 'get',
        success: function (res) {
            let arr = res.data.parametersChildList
            let str = '<option></option>'
            $.each(arr, function (i, k) {
                str += `<option value="${k.name}" >${k.name}</option>`
                jcwhlist.push({
                    name: k.name
                })
            })
            $('.jcwhlist').html(str)
            layform.render()
        }
    })
    // 获取地区
    $.ajax({
        url: `${API}/cities/getAllProvinces`,
        type: 'get',
        success: function (res) {
            let str = ''
            $.each(res.data, function (i, n) {
                str += `<option value="${n.provinceid}">${n.province}</option>`
            })
            $('.drivingRange1').append(str)
            $('.drivingRange3').append(str)
            layform.on('select(drivingRange1)', function (data) {
                console.log(data)
                $.ajax({
                    url: `${API}/cities/selectByProId?proId=${data.value}`,
                    type: 'get',
                    success: function (res) {
                        let shi = ''
                        $.each(res.data, function (i, n) {

                            shi += `<option value="${n.city}">${n.city}</option>`
                        })
                        $('.drivingRange2').append(shi)
                        layform.render()
                    }
                })
            })
            layform.on('select(drivingRange3)', function (data) {
                console.log(data)
                $.ajax({
                    url: `${API}/cities/selectByProId?proId=${data.value}`,
                    type: 'get',
                    success: function (res) {
                        let shi = ''
                        $.each(res.data, function (i, n) {

                            shi += `<option value="${n.city}">${n.city}</option>`
                        })
                        $('.drivingRange4').append(shi)
                        layform.render()
                    }
                })
            })
        }
    })
    $(function () {
    	
        $.ajax({
            url: API + '/erpManagement/gojianceweihuByOrder?order=' + sessionStorage.sheelId,
            type: 'get',
            dataType: 'json',
            success: function (res) {
                console.log(res)
                var arr = res.data.contents;
                var str = '';
                var shang=res.data.inspectionOrder[0];
                $("#inspectionDt").val(shang.inspectionDt);
				$("#formId").val(shang.formId);
				$("#place").val(shang.place);
				$("#drivingRange1").val(shang.drivingRange1);
				$("#drivingRange2").val(shang.drivingRange2);
				$("#drivingRange3").val(shang.drivingRange3);
				$("#drivingRange4").val(shang.drivingRange4);
				$("#mileage").val(shang.mileage);
				if(shang.roadStatus==0){
					$("#roadStatus").val("国道省道");
				}else if(shang.roadStatus==1){
					$("#roadStatus").val("高速/国道");
				}else if(shang.roadStatus==2){
					$("#roadStatus").val("丘陵/盘山");
				}else if(shang.roadStatus==3){
					$("#roadStatus").val("水泥路面");
				}else if(shang.roadStatus==4){
					$("#roadStatus").val("泥土道路");
				}else if(shang.roadStatus==5){
					$("#roadStatus").val("混合道路");
				}else if(shang.roadStatus==6){
					$("#roadStatus").val("非道路");
				}else if(shang.roadStatus==7){
					$("#roadStatus").val("城镇道路");
				}
				 $("#actualFee").val(shang.actualFee);
				$("#allFee").val(shang.allFee);
				$("#integral").val(shang.integral);
				$("#integralFee").val(shang.integralFee);
				$("#paidMethod").val(shang.paidMethod);
				$("#customerName").val(shang.customerName);
				$("#attn").val(shang.attn);
                $.each(arr, function (i, n) {
                    str += `<tr  class="carList">
                <td>${i + 1}</td>
                <td><input type="text" data-name='brand' class="layui-input" value="${n.brand == null ? '' : n.brand}" readonly></td>
                <td><input type="text" data-name='size' class="layui-input" value="${n.size == null ? '' : n.size}" readonly></td>
                <td><input type="text" data-name='specification' class="layui-input" value="${n.specification == null ? '' : n.specification}" readonly></td>
                
                <td><input type="text" data-name='produceId' class="layui-input" value="${n.produceId == null ? '' : n.produceId}" readonly></td>
                <td><input type="text" data-name='tirePlace' class="layui-input" value="${n.tirePlace == null ? '' : n.tirePlace}" readonly></td>
                <td><input type="text" data-name='errorOrTure' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='pressureModi' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='coreCap' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='minorRepairs' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='deepLines1' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='deepLines2' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='deepLines3' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='deepLines4' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='tireStatus' class="layui-input" value="" readonly></td>
                <td><input type="text" data-name='useDevice' class="layui-input" value="" readonly></td>
                <td style='width:50px;'>${n.pressureModi == null ? '' : n.pressureModi}</td>
                <td style='width:50px;'>${n.deepLines1 == null ? '' : n.deepLines1}</td>
                <td style='width:50px;'>${n.deepLines2 == null ? '' : n.deepLines2}</td>
                <td style='width:50px;'>${n.deepLines3 == null ? '' : n.deepLines3}</td>
                <td style='width:50px;'>${n.deepLines4 == null ? '' : n.deepLines4}</td>
                <td style='width:60px;'>${n.tireStatus == null ? '' : n.tireStatus}</td>
                
            </tr>`
                })

                $("#list").html(str);

            },
            error: function (err) {
                alert("系统错误");

            }
        });

    })
    // 保存
    function saveAll() {
        let data = {}

        // $('.jfxf input').each(function (i, n) {
        //     data[$(this).data('name')] = $(this).val()
        // })
        data.custId = 1
        data.userId = 1
        $('.jcinfo input').each(function (i, n) {
            data[$(this).data('name')] = $(this).val()
        })
        console.log($('.yylk').val(), '22')
        data.roadStatus = $('.layui-unselect').eq(0).val()
        data.paidMethod = $('.layui-unselect').eq(1).val()
        data.carPlate = decodeURI(decodeURI(GetRequest().id))
        data.drivingRange1 = $('.drivingRange1').val()
        data.drivingRange2 = $('.drivingRange2').val()
        data.drivingRange3 = $('.drivingRange3').val()
        data.drivingRange4 = $('.drivingRange4').val()
        $.ajax({
            url: `${API}/erpManagement/gojianceweihuCarDataSure`,
            type: 'get',
            data: data,
            success: function (res) {
                $('.carList').each(function () {
                    let datas = {}
                    datas.carPlate = decodeURI(decodeURI(GetRequest().id))
                    datas.orderId = res.data.inspectionOrder.id
                    datas.formId = res.data.management.workId
                    $(this).find('input').each(function () {


                        datas[$(this).data('name')] = $(this).val()
                    })
                    $.ajax({
                        url: `${API}/erpManagement/jianceweihuCarInspectionContent`,
                        type: 'post',
                        data: datas,
                        success: function (res) {
                            console.log(res)
                        }
                    })
                })

            }
        })

    }

</script>

</html>